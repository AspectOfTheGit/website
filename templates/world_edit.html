<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editing {{ title }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>

<body>
    <nav class="navbar">
        <div class="logo">
            <a href="https://aspectofthe.site/" class="logo">
                <img src="{{ url_for('static', filename='icons/favicon.png') }}" alt="Logo" class="logo-img">
            </a>
            {{ title }}
        </div>
        <div class="nav-links">
            View
            Settings
        </div>
        <div class="login">
            <a href="/account">{{ username }}</a>
        </div>
    </nav>

    <main>
        <p class="title">
            World Page Editor WIP
        </p>
    </main>

    <div class="editor-sidebar collapsed">
        <div class="editor-sidebar-handle">
            <span>Editor</span>
        </div>
        <div class="editor-sidebar-panel">
            <div class="editor-sidebar-content">
                <!-- Editor Elements -->
                <div class="editor-element" draggable="true" data-type="text" data-sidebar="true">
                    <span class="editor-element-title">Text</span>
                    <span class="editor-element-desc">Add a text block</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sidebar = document.querySelector(".editor-sidebar");
        const panel = document.querySelector(".editor-sidebar-panel");
        const handle = document.querySelector(".editor-sidebar-handle");
        
        let dragged = null;
        let offsetX = 0;
        let offsetY = 0;
        
        document.addEventListener("pointerdown", e => {
            const el = e.target.closest(".editor-element");
            if (!el) return;

            // Clone from editor
            if (el.getAttribute("data-sidebar") == "true") {
                dragged = el.cloneNode(true);
                dragged.classList.add("dragging");
                dragged.setAttribute("data-sidebar","false");
                document.body.appendChild(dragged);
            } else {// Move element
                el.classList.add("dragging");
                el.classList.remove("placed");
                dragged = el;
            }
            
        
            const rect = el.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
        
            moveDragged(e.clientX, e.clientY);

            sidebar.classList.add("collapsed");
            sidebar.classList.remove("expanded");
        
            dragged.setPointerCapture(e.pointerId);
        
            e.preventDefault();
        });
        
        document.addEventListener("pointermove", e => {
            if (!dragged) return;
            moveDragged(e.clientX, e.clientY);
        
            const handleRect = handle.getBoundingClientRect();
        
            if (
                e.clientY > handleRect.top - 40 &&
                e.clientY < handleRect.bottom + 40
            ) {
                sidebar.classList.remove("collapsed");
                sidebar.classList.add("expanded");
            }
        });
        
        document.addEventListener("pointerup", e => {
            if (!dragged) return;
        
            const sidebarRect = sidebar.getBoundingClientRect();
        
            if (e.clientY > sidebarRect.top && e.clientY < sidebarRect.bottom) {
                dragged.remove();
            } else {
                dragged.classList.remove("dragging");
                dragged.classList.add("placed");
                dragged.style.position = "absolute";
                dragged.style.left = `${e.pageX - offsetX}px`;
                dragged.style.top = `${e.pageY - offsetY}px`;
                dragged.style.cursor = "default";
            }
        
            dragged = null;
            sidebar.classList.add("collapsed");
            sidebar.classList.remove("expanded");
        });
        
        function moveDragged(x, y) {
            dragged.style.left = `${x - offsetX}px`;
            dragged.style.top = `${y - offsetY}px`;
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.querySelector(".editor-sidebar");
            const handle = sidebar.querySelector(".editor-sidebar-handle");
    
            handle.addEventListener("click", () => {
                sidebar.classList.toggle("expanded");
                sidebar.classList.toggle("collapsed");
            });
        });
    </script>
</body>
</html>
