<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editing {{ title }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>

<body class="world">
    <nav class="navbar">
        <div class="logo">
            <a href="https://aspectofthe.site/" class="logo">
                <img src="{{ url_for('static', filename='icons/favicon.png') }}" alt="Logo" class="logo-img">
            </a>
            {{ title }}
        </div>
        <div class="nav-links">
            <a id="view-btn" class="nav-btn">View</a>
            <a id="settings-btn" class="nav-btn">Settings</a>
        </div>
        <div class="login">
            <a href="/account">{{ username }}</a>
        </div>
    </nav>

    <div class="editor-sidebar collapsed">
        <div class="editor-sidebar-handle">
            <span>Editor</span>
        </div>
        <div class="editor-sidebar-panel">
            <div class="editor-sidebar-content">
                <!-- Editor Elements -->
                <div class="editor-element" draggable="true" data-type="text" data-sidebar="true">
                    <span class="editor-element-title">Text</span>
                    <span class="editor-element-desc">Basic text</span>
                </div>
                <div class="editor-element" draggable="true" data-type="input" data-sidebar="true">
                    <span class="editor-element-title">Input</span>
                    <span class="editor-element-desc">User can type something</span>
                </div>
                <div class="editor-element" draggable="true" data-type="button" data-sidebar="true">
                    <span class="editor-element-title">Button</span>
                    <span class="editor-element-desc">Do something when pressed</span>
                </div>
                <div class="editor-element" draggable="true" data-type="color" data-sidebar="true">
                    <span class="editor-element-title">Color</span>
                    <span class="editor-element-desc">Solid color pixel</span>
                </div>
            </div>
        </div>
    </div>

    <div class="editor-menu-overlay hidden">
        <div class="editor-menu">
            <div class="editor-menu-tabs">
                <button class="editor-menu-tab active" data-tab="properties">Properties</button>
                <button class="editor-menu-tab" data-tab="extra">Extra</button>
                <button class="editor-menu-tab" data-tab="logic">Logic</button>
            </div>
    
            <div class="editor-menu-content">
                <div class="editor-menu-panel active" id="tab-properties">
                    <h3>Properties</h3>
                </div>
    
                <div class="editor-menu-panel" id="tab-extra">
                    <h3>Extra</h3>
                </div>
    
                <div class="editor-menu-panel" id="tab-logic">
                    <h3>Logic</h3>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sidebar = document.querySelector(".editor-sidebar");
        const panel = document.querySelector(".editor-sidebar-panel");
        const handle = document.querySelector(".editor-sidebar-handle");
        const menuOverlay = document.querySelector(".editor-menu-overlay");
        const menuTabs = document.querySelectorAll(".editor-menu-tab");
        const menuPanels = document.querySelectorAll(".editor-menu-panel");
        
        let dragged = null;
        let offsetX = 0;
        let offsetY = 0;
        let holding = false;
        let dragging = false;
        
        document.addEventListener("pointerdown", e => {
            const el = e.target.closest(".editor-element");
            if (!el) return;

            // Clone from editor
            if (el.getAttribute("data-sidebar") == "true") {
                dragged = el.cloneNode(true);
                dragged.classList.add("dragging");
                dragged.setAttribute("data-sidebar","false");
                document.body.appendChild(dragged);
                dragging = true;

                const rect = el.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
            
                moveDragged(e.clientX, e.clientY);
            
                dragged.setPointerCapture(e.pointerId);
            
                e.preventDefault();
            } else {// Move element
                holding = true;
                dragging = false;
                dragged = el;
                setTimeout(() => {
                    if (holding) {
                        el.setAttribute("draggable", "true");
                        el.classList.add("dragging");
                        el.classList.remove("placed");
                        dragging = true;
                        dragged = el;

                        const rect = el.getBoundingClientRect();
                        offsetX = e.clientX - rect.left;
                        offsetY = e.clientY - rect.top;
                    
                        moveDragged(e.clientX, e.clientY);
                    
                        el.setPointerCapture(e.pointerId);
                    
                        e.preventDefault();
                    } else {
                        return;
                    }
                }, 300);
            }
        });
        
        document.addEventListener("pointermove", e => {
            if (!dragged) return;
            moveDragged(e.clientX, e.clientY);
        
            const handleRect = handle.getBoundingClientRect();
        
            if (e.clientY > handleRect.top - 40) {
                sidebar.classList.remove("collapsed");
                sidebar.classList.add("expanded");
            } else {
                sidebar.classList.remove("expanded");
                sidebar.classList.add("collapsed");
            }
        });
        
        document.addEventListener("pointerup", e => {
            holding = false;
            if (!dragged) return;
        
            const sidebarRect = sidebar.getBoundingClientRect();

            if (dragging) {
                if (e.clientY > sidebarRect.top && e.clientY < sidebarRect.bottom) {
                    dragged.remove();
                } else {
                    dragged.classList.remove("dragging");
                    dragged.classList.add("placed");
                    dragged.style.position = "absolute";
                    dragged.style.left = `${e.pageX - offsetX}px`;
                    dragged.style.top = `${e.pageY - offsetY}px`;
                    dragged.style.cursor = "default";
                    dragged.setAttribute("draggable", "false");
                }
        
                dragged = null;
                sidebar.classList.add("collapsed");
                sidebar.classList.remove("expanded");
                dragging = false;
            } else {
                // Element editor
                const el = e.target.closest(".placed");
                if (!el) return;
                
                openEditorMenu();
            }
        });
        
        function moveDragged(x, y) {
            dragged.style.left = `${x - offsetX}px`;
            dragged.style.top = `${y - offsetY}px`;
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.querySelector(".editor-sidebar");
            const handle = sidebar.querySelector(".editor-sidebar-handle");
    
            handle.addEventListener("click", () => {
                sidebar.classList.toggle("expanded");
                sidebar.classList.toggle("collapsed");
            });
        });
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                if (btn.getAttribute("id") == "view-btn") {
                    window.location.href = "http://aspectofthe.site/world/{{ world_uuid }}";
                }
                if (btn.getAttribute("id") == "settings-btn") {
                    // Page settings
                }
            });
        });

        // Menu
        
        function openEditorMenu() {
            menuOverlay.classList.remove("hidden");
        }
        
        function closeEditorMenu() {
            menuOverlay.classList.add("hidden");
        }
        
        menuOverlay.addEventListener("click", e => {
            if (e.target === menuOverlay) closeEditorMenu();
        });
        
        menuTabs.forEach(tab => {
            tab.addEventListener("click", () => {
                menuTabs.forEach(t => t.classList.remove("active"));
                menuPanels.forEach(p => p.classList.remove("active"));
        
                tab.classList.add("active");
                document
                    .getElementById("tab-" + tab.dataset.tab)
                    .classList.add("active");
            });
        });
    </script>
</body>
</html>
