<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editing {{ title }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>

<body class="world">
    <nav class="navbar">
        <div class="logo">
            <a href="https://aspectofthe.site/" class="logo">
                <img src="{{ url_for('static', filename='icons/favicon.png') }}" alt="Logo" class="logo-img">
            </a>
            {{ title }}
        </div>
        <div class="nav-links">
            <a id="view-btn" class="nav-btn">View</a>
            <a id="settings-btn" class="nav-btn">Settings</a>
        </div>
        <div class="login">
            <a href="/account">{{ username }}</a>
        </div>
    </nav>

    <div class="editor-sidebar collapsed">
        <div class="editor-sidebar-handle">
            <span>Editor</span>
        </div>
        <div class="editor-sidebar-panel">
            <div class="editor-sidebar-content">
                <!-- Editor Elements -->
                <div class="editor-element" draggable="true" data-type="text" data-sidebar="true">
                    <span class="editor-element-title">Text</span>
                    <span class="editor-element-desc">Basic text</span>
                </div>
                <div class="editor-element" draggable="true" data-type="input" data-sidebar="true">
                    <span class="editor-element-title">Input</span>
                    <span class="editor-element-desc">User can type something</span>
                </div>
                <div class="editor-element" draggable="true" data-type="button" data-sidebar="true">
                    <span class="editor-element-title">Button</span>
                    <span class="editor-element-desc">Do something when pressed</span>
                </div>
                <div class="editor-element" draggable="true" data-type="color" data-sidebar="true">
                    <span class="editor-element-title">Color</span>
                    <span class="editor-element-desc">Solid color pixel</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sidebar = document.querySelector(".editor-sidebar");
        const panel = document.querySelector(".editor-sidebar-panel");
        const handle = document.querySelector(".editor-sidebar-handle");
        
        let dragged = null;
        let offsetX = 0;
        let offsetY = 0;
        let holding = false;
        let dragging = false;
        
        document.addEventListener("pointerdown", e => {
            const el = e.target.closest(".editor-element");
            if (!el) return;

            // Clone from editor
            if (el.getAttribute("data-sidebar") == "true") {
                dragged = el.cloneNode(true);
                dragged.classList.add("dragging");
                dragged.setAttribute("data-sidebar","false");
                document.body.appendChild(dragged);
            } else {// Move element
                holding = true;
                dragging = false;
                dragged = el;
                setTimeout(() => {
                    if (holding) {
                        el.setAttribute("draggable", "true");
                        el.classList.add("dragging");
                        el.classList.remove("placed");
                        dragging = true;
                    } else {
                        return;
                    }
                }, 300);
            }
            
        
            const rect = el.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
        
            moveDragged(e.clientX, e.clientY);

            sidebar.classList.add("collapsed");
            sidebar.classList.remove("expanded");
        
            dragged.setPointerCapture(e.pointerId);
        
            e.preventDefault();
        });
        
        document.addEventListener("pointermove", e => {
            if (!dragged) return;
            moveDragged(e.clientX, e.clientY);
        
            const handleRect = handle.getBoundingClientRect();
        
            if (
                e.clientY > handleRect.top - 40 &&
                e.clientY < handleRect.bottom + 40
            ) {
                sidebar.classList.remove("collapsed");
                sidebar.classList.add("expanded");
            }
        });
        
        document.addEventListener("pointerup", e => {
            holding = false;
            if (!dragged) return;
        
            const sidebarRect = sidebar.getBoundingClientRect();

            if (dragging) {
                if (e.clientY > sidebarRect.top && e.clientY < sidebarRect.bottom) {
                    dragged.remove();
                } else {
                    dragged.classList.remove("dragging");
                    dragged.classList.add("placed");
                    dragged.style.position = "absolute";
                    dragged.style.left = `${e.pageX - offsetX}px`;
                    dragged.style.top = `${e.pageY - offsetY}px`;
                    dragged.style.cursor = "default";
                    dragged.setAttribute("draggable", "false");
                }
        
                dragged = null;
                sidebar.classList.add("collapsed");
                sidebar.classList.remove("expanded");
                dragging = false;
            } else {
                // Element editor
            }
        });
        
        function moveDragged(x, y) {
            dragged.style.left = `${x - offsetX}px`;
            dragged.style.top = `${y - offsetY}px`;
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.querySelector(".editor-sidebar");
            const handle = sidebar.querySelector(".editor-sidebar-handle");
    
            handle.addEventListener("click", () => {
                sidebar.classList.toggle("expanded");
                sidebar.classList.toggle("collapsed");
            });
        });
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                if (btn.getAttribute("id") == "view-btn") {
                    window.location.href = "http://aspectofthe.site/world/b9952d54-1abf-4193-82c3-6755f0c3fe4c";
                }
            });
        });
    </script>
</body>
</html>
