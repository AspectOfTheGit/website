<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ bot_name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>
<footer class="site-footer">
  <div class="footer-left">
    <a href="https://store.legitimoose.com" target="_blank" rel="noopener noreferrer">
        <img src="{{ url_for('static', filename='icons/cart.svg') }}" alt="Store" width="64" height="64">
    </a>
  </div>

  <div class="footer-center">
    <p>
      This is not an official Moose project and is made by the community.<br>
      We have no affiliation with any real-world brands.<br>
      Not affiliated with Mojang AB or Partners.
    </p>
  </div>

  <div class="footer-right">
    <a href="https://www.youtube.com/@Legitimoose" target="_blank" rel="noopener noreferrer">
        <img src="{{ url_for('static', filename='icons/youtube.svg') }}" alt="YouTube" width="64" height="64">
    </a>
  </div>
</footer>

<body>
    <nav class="navbar">
        <div class="logo">
            <a href="https://aspectofthe.site/" class="logo">
                <img src="{{ url_for('static', filename='icons/favicon.png') }}" alt="Logo" width="64" height="64">
            </a>
            Aspect Bots
        </div>
        <div class="nav-links">
            <a href="/bots">Home</a>
            <a href="/bots/status">Bot status</a>
            <a href="/bots/deploy">Deploy bot</a>
        </div>
        <div class="login">
            {% if username %}
                <a href="/account">{{ username }}</a>
            {% else %}
                <a href="/login">Log in</a>
            {% endif %}
        </div>
    </nav>

    <h2>Live Log for {{ bot_name }}</h2>
    {% if is_deployer %}
        <h3>You deployed this bot</h3>
    {% endif %}

<div class="tab-container">
    <div class="tabs">
        <button class="tab-button active" data-tab="log">Log</button>
        <button class="tab-button" data-tab="screenshot">Screenshot</button>
    </div>

    <div class="controls">
        {% if is_deployer %}
            <button title="Disconnect bot" id="disconnect-btn" class="disconnect-button">
                <img src="{{ url_for('static', filename='icons/disconnect.svg') }}" class="disconnect-icon" alt="Disconnect">
            </button>
            <button title="Switch server" id="switch-server-btn" class="switch-server-button">
                <img src="{{ url_for('static', filename='icons/switch.svg') }}" class="switch-icon" alt="Switch Server">
            </button>
        {% endif %}
        <button title="Screenshot" id="screenshot-btn" class="screenshot-button">
            <img src="{{ url_for('static', filename='icons/screenshot.svg') }}" class="camera-icon" alt="Screenshot">
        </button>
    </div>

    <div id="log" class="tab-content active">
        <div id="log-container"></div>
    </div>

    <div id="screenshot" class="tab-content">
        <div id="screenshot-output">No screenshot taken yet.</div>
    </div>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const socket = io("https://aspectofthe.site", { transports: ["websocket"] });
    const logContainer = document.getElementById("log-container");
    const screenshotOutput = document.getElementById("screenshot-output");
    const botName = {{ bot_name|tojson }};

    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            tabButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const target = btn.dataset.tab;
            tabContents.forEach(c => c.classList.remove('active'));
            document.getElementById(target).classList.add('active');
        });
    });

    socket.emit('join', botName );

    socket.on("log", (contents) => {
        const time = contents[0];
        const msg = contents[1];
        logContainer.innerHTML += `[${time}] ${msg}<br>`;
        logContainer.scrollTop = logContainer.scrollHeight;
    });

    socket.on("screenshot", (data) => {
        const img = document.createElement("img");
        img.src = "data:image/png;base64," + data.image;
        img.alt = data.filename;
        img.style.maxWidth = "100%";
        img.style.maxHeight = "100%";
    
        screenshotOutput.innerHTML = "";
        screenshotOutput.appendChild(img);
    
        document.querySelector('[data-tab="screenshot"]').click();
    });

    document.getElementById("screenshot-btn").addEventListener("click", () => {
        socket.emit("get_screenshot", { bot: botName });
    });
    {% if is_deployer %}
        document.getElementById("disconnect-btn").addEventListener("click", () => {
            socket.emit("bot_disconnect", { bot: botName });
        });
        document.getElementById("switch-server-btn").addEventListener("click", () => {
            const worldUUID = prompt("World UUID");
            socket.emit("bot_switch_server", { bot: botName, world: worldUUID });
        });
    {% endif %}
});
</script>

