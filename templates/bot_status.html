<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aspect Bots</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icons/favicon.png') }}">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <a href="https://aspectofthe.site/" class="logo">
                <img src="{{ url_for('static', filename='icons/favicon.png') }}" alt="Logo" class="logo-img">
            </a>
            Aspect Bots
        </div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/status">Bot status</a>
            <a href="#">Deploy bot</a>
        </div>
        <div class="login">
            <a href="/login">Log in</a>
        </div>
    </nav>

    <h2>Live Log for {{ bot_name }}</h2>

    <div class="tab-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="log">Log</button>
            <button class="tab-button" data-tab="screenshot">Screenshot</button>
        </div>

        <div class="controls">
            <button id="screenshot-btn" class="screenshot-button">
                <img src="{{ url_for('static', filename='icons/camera.png') }}" class="camera-icon" alt="Screenshot">
            </button>
        </div>

        <div id="log" class="tab-content active">
            <div id="log-container"></div>
        </div>

        <div id="screenshot" class="tab-content">
            <div id="screenshot-output">No screenshot taken yet.</div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io("https://aspectofthe.site", { transports: ["websocket"] });
            const logContainer = document.getElementById("log-container");
            const screenshotOutput = document.getElementById("screenshot-output");
            const botName = {{ bot_name|tojson }};

            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const target = btn.dataset.tab;
                    tabContents.forEach(c => c.classList.remove('active'));
                    document.getElementById(target).classList.add('active');
                });
            });

            socket.emit('join', botName);
            socket.on("log", (contents) => {
                const time = contents[0];
                const msg = contents[1];
                logContainer.textContent += `[${time}] ${msg}\n`;
                logContainer.scrollTop = logContainer.scrollHeight;
            });

            document.getElementById("screenshot-btn").addEventListener("click", () => {
                socket.emit("screenshot", {bot: botName});
                document.querySelector('[data-tab="screenshot"]').click();
            });
        });
    </script>
</body>
</html>
